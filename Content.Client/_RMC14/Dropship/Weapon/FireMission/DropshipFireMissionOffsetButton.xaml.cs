using Robust.Client.AutoGenerated;
using Robust.Client.Graphics;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;

namespace Content.Client._RMC14.Dropship.Weapon.FireMission;

[GenerateTypedNameReferences]
public sealed partial class DropshipFireMissionOffsetButton : Button
{
    public int? Offset { get; set; }

    private Action<ButtonEventArgs>? _onPressed;

    public DropshipFireMissionOffsetButton()
    {
        RobustXamlLoader.Load(this);
    }

    private StyleBoxFlat ActiveStyleBox()
    {
        var selectedColor = Color.FromHex("#00FF36");
        var backgroundColor = Color.Transparent;

        if (DrawMode is DrawModeEnum.Hover or DrawModeEnum.Pressed)
            backgroundColor = selectedColor;

        return new StyleBoxFlat
        {
            BackgroundColor = backgroundColor,
            BorderColor = selectedColor,
            BorderThickness = new Thickness(2),
        };
    }

    public void Refresh()
    {
        var box = ActiveStyleBox();
        if (Pressed)
        {
            var text = Offset.HasValue ? Offset.Value.ToString() : "-";
            Text = $"[ {text} ]";
            Label.ModulateSelfOverride = Color.FromHex("#00FF36");
        }
        StyleBoxOverride = box;
    }

    public void SetOnPressed(Action<ButtonEventArgs>? action)
    {
        OnPressed -= _onPressed;
        if (action == null)
            return;

        _onPressed = action;
        OnPressed += action;
    }
}
