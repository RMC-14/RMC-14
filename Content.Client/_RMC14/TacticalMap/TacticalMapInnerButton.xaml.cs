using Content.Client.Message;
using Robust.Client.AutoGenerated;
using Robust.Client.Graphics;
using Robust.Client.UserInterface.Controls;
using Robust.Client.UserInterface.XAML;
using Robust.Shared.Maths;
using Robust.Shared.Timing;

namespace Content.Client._RMC14.TacticalMap;

[GenerateTypedNameReferences]
public sealed partial class TacticalMapInnerButton : Button
{
    public static readonly Color DefaultHoveredColor = Color.White;
    public static readonly Color DefaultUnhoveredColor = Color.White;
    public static readonly Color DefaultTextColor = Color.FromHex("#88C7FA");
    public static readonly Color DefaultHoveredTextColor = Color.FromHex("#E6F3FF");
    public static readonly Color DefaultDisabledColor = Color.White;
    public static readonly Color DefaultDisabledTextColor = Color.FromHex("#4AA3E8");

    private bool _initialized;
    private string? _text;

    public Color HoveredColor { get; set; } = DefaultHoveredColor;

    public Color UnhoveredColor { get; set; } = DefaultUnhoveredColor;

    public Color TextColor { get; set; } = DefaultTextColor;

    public Color HoveredTextColor { get; set; } = DefaultHoveredTextColor;

    public Color DisabledColor { get; set; } = DefaultDisabledColor;

    public Color DisabledTextColor { get; set; } = DefaultDisabledTextColor;

    public string? LabelText
    {
        get => _text;
        set
        {
            _text = value;
            UpdateText();
        }
    }

    public TacticalMapInnerButton()
    {
        RobustXamlLoader.Load(this);
        StyleBoxOverride = new StyleBoxFlat
        {
            BackgroundColor = Color.FromHex("#00000000"),
            BorderColor = Color.FromHex("#00000000"),
            BorderThickness = new Thickness(0),
        };
        UpdateColor();
    }

    protected override void DrawModeChanged()
    {
        base.DrawModeChanged();
        UpdateColor();
    }

    private void UpdateColor()
    {
        ModulateSelfOverride = (Disabled, IsHovered) switch
        {
            (true, _) => DisabledColor,
            (_, true) => HoveredColor,
            _ => UnhoveredColor
        };

        UpdateText();
    }

    private void UpdateText()
    {
        if (NameScope != null)
        {
            var color = Disabled ? DisabledTextColor : (IsHovered ? HoveredTextColor : TextColor);
            Label.SetMarkup($"[color={color.ToHex()}][bold]{LabelText ?? string.Empty}[/bold][/color]");
        }
    }

    protected override void FrameUpdate(FrameEventArgs args)
    {
        base.FrameUpdate(args);

        if (_initialized)
            return;

        _initialized = true;
        UpdateColor();
    }
}
